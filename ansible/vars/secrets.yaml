---
# ============================================================================
# STOA Platform - Secrets Configuration for Ansible Playbooks
# ============================================================================
#
# SECRETS STRATEGY:
# -----------------
# 1. BOOTSTRAP/INITIAL SECRETS (AWS Secrets Manager)
#    - Used during platform initialization
#    - Managed by Terraform (terraform/modules/secrets)
#    - Retrieved via External Secrets Operator or AWS CLI
#    - Examples: gateway admin, keycloak admin, RDS passwords
#
# 2. RUNTIME SECRETS (Kubernetes Secrets / HashiCorp Vault)
#    - Generated and managed by the running platform
#    - OAuth client secrets, tenant application secrets
#    - Stored in K8s Secrets or HashiCorp Vault
#
# AWS Secrets Manager paths:
#   stoa/{env}/gateway-admin      - Gateway Administrator credentials
#   stoa/{env}/keycloak-admin     - Keycloak Administrator credentials
#   stoa/{env}/rds-master         - RDS PostgreSQL credentials
#   stoa/{env}/opensearch-master  - OpenSearch credentials
#   stoa/{env}/gitlab-token       - GitLab API token
#   stoa/{env}/awx-token          - AWX API token
#
# NEVER hardcode secrets in playbooks or commit to Git!
# ============================================================================

# Gateway Admin credentials
# Source: AWS Secrets Manager -> K8s External Secret -> Environment Variable
# Path: stoa/{env}/gateway-admin
gateway_user: "{{ lookup('env', 'GATEWAY_ADMIN_USER') | default('Administrator', true) }}"
gateway_password: "{{ lookup('env', 'GATEWAY_PASSWORD') }}"

# Keycloak Admin credentials
# Source: AWS Secrets Manager -> K8s External Secret -> Environment Variable
# Path: stoa/{env}/keycloak-admin
keycloak_admin_user: "{{ lookup('env', 'KEYCLOAK_ADMIN_USER') }}"
keycloak_admin_password: "{{ lookup('env', 'KEYCLOAK_ADMIN_PASSWORD') }}"

# GitLab API Token
# Source: AWS Secrets Manager -> K8s External Secret -> Environment Variable
# Path: stoa/{env}/gitlab-token
gitlab_token: "{{ lookup('env', 'GITLAB_TOKEN') }}"
gitlab_webhook_secret: "{{ lookup('env', 'GITLAB_WEBHOOK_SECRET') }}"

# AWX Token
# Source: AWX generates this -> stored in AWS Secrets Manager
# Path: stoa/{env}/awx-token
awx_token: "{{ lookup('env', 'AWX_TOKEN') }}"

# Kafka SASL credentials (if using SASL authentication)
# Source: K8s Secret 'kafka-secrets' in stoa-system namespace
kafka_sasl_username: "{{ lookup('env', 'KAFKA_SASL_USERNAME') | default('', true) }}"
kafka_sasl_password: "{{ lookup('env', 'KAFKA_SASL_PASSWORD') | default('', true) }}"

# ============================================================================
# VALIDATION
# ============================================================================
# These assertions ensure required secrets are present before playbook runs
# Comment out during local development if needed

_validate_gateway_password: "{{ gateway_password | mandatory }}"
