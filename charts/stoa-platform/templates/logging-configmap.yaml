{{- /*
STOA Platform Logging ConfigMap
This ConfigMap is consumed by all STOA components for centralized logging configuration.
Values are populated from gitops-templates/logging/*.yaml via Helm values.
*/ -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: stoa-logging-config
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/name: stoa-logging
    app.kubernetes.io/component: config
    app.kubernetes.io/part-of: stoa-platform
    {{- with .Values.global.environment }}
    environment: {{ . }}
    {{- end }}
data:
  # Global log level
  LOG_LEVEL: {{ .Values.logging.level | default "INFO" | quote }}

  # Output format (json for Loki, text for local dev)
  LOG_FORMAT: {{ .Values.logging.format | default "json" | quote }}

  # Per-component log levels (JSON encoded)
  LOG_COMPONENTS: {{ .Values.logging.components | toJson | quote }}

  # HTTP debugging
  LOG_DEBUG_HTTP_REQUESTS: {{ .Values.logging.debug.http_requests | default false | quote }}
  LOG_DEBUG_HTTP_RESPONSES: {{ .Values.logging.debug.http_responses | default false | quote }}
  LOG_DEBUG_HTTP_HEADERS: {{ .Values.logging.debug.http_headers | default false | quote }}
  LOG_DEBUG_HTTP_BODY: {{ .Values.logging.debug.http_body | default false | quote }}

  # SSL/TLS debugging
  LOG_DEBUG_SSL_HANDSHAKE: {{ .Values.logging.debug.ssl_handshake | default false | quote }}
  LOG_DEBUG_SSL_CERTIFICATES: {{ .Values.logging.debug.ssl_certificates | default false | quote }}

  # Kafka debugging
  LOG_DEBUG_KAFKA_MESSAGES: {{ .Values.logging.debug.kafka_messages | default false | quote }}
  LOG_DEBUG_KAFKA_CONSUMER: {{ .Values.logging.debug.kafka_consumer | default false | quote }}
  LOG_DEBUG_KAFKA_PRODUCER: {{ .Values.logging.debug.kafka_producer | default false | quote }}

  # SQL debugging
  LOG_DEBUG_SQL_QUERIES: {{ .Values.logging.debug.sql_queries | default false | quote }}
  LOG_DEBUG_SQL_RESULTS: {{ .Values.logging.debug.sql_results | default false | quote }}
  LOG_DEBUG_SQL_TRANSACTIONS: {{ .Values.logging.debug.sql_transactions | default false | quote }}

  # Authentication debugging
  LOG_DEBUG_AUTH_TOKENS: {{ .Values.logging.debug.auth_tokens | default false | quote }}
  LOG_DEBUG_AUTH_HEADERS: {{ .Values.logging.debug.auth_headers | default false | quote }}
  LOG_DEBUG_AUTH_PAYLOAD: {{ .Values.logging.debug.auth_payload | default false | quote }}

  # External services debugging
  LOG_DEBUG_AWX_API: {{ .Values.logging.debug.awx_api | default false | quote }}
  LOG_DEBUG_GITLAB_API: {{ .Values.logging.debug.gitlab_api | default false | quote }}
  LOG_DEBUG_KEYCLOAK_API: {{ .Values.logging.debug.keycloak_api | default false | quote }}
  LOG_DEBUG_GATEWAY_API: {{ .Values.logging.debug.gateway_api | default false | quote }}

  # Tracing configuration
  LOG_TRACE_ENABLED: {{ .Values.logging.tracing.enabled | default false | quote }}
  LOG_TRACE_SAMPLE_RATE: {{ .Values.logging.tracing.sample_rate | default "0.1" | quote }}
  LOG_TRACE_EXPORT_ENDPOINT: {{ .Values.logging.tracing.export_endpoint | default "" | quote }}

  # Context binding
  LOG_CONTEXT_TENANT_ID: {{ .Values.logging.context.include_tenant_id | default true | quote }}
  LOG_CONTEXT_USER_ID: {{ .Values.logging.context.include_user_id | default true | quote }}
  LOG_CONTEXT_REQUEST_ID: {{ .Values.logging.context.include_request_id | default true | quote }}
  LOG_CONTEXT_TRACE_ID: {{ .Values.logging.context.include_trace_id | default true | quote }}

  # Filtering
  LOG_EXCLUDE_PATHS: {{ .Values.logging.filtering.exclude_paths | toJson | quote }}
  LOG_SLOW_REQUEST_THRESHOLD_MS: {{ .Values.logging.filtering.slow_request_threshold_ms | default 1000 | quote }}
  LOG_ACCESS_SAMPLE_RATE: {{ .Values.logging.filtering.access_log_sample_rate | default "1.0" | quote }}

  # Masking
  LOG_MASKING_ENABLED: {{ .Values.logging.masking.enabled | default true | quote }}
  LOG_MASKING_PATTERNS: {{ .Values.logging.masking.patterns | toJson | quote }}
