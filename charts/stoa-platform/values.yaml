# Default values for stoa-platform.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global settings
global:
  baseDomain: stoa.cab-i.com

# Override names
nameOverride: ""
fullnameOverride: ""

# Service account
serviceAccount:
  create: true
  name: ""

# =============================================================================
# Keycloak Configuration
# =============================================================================
keycloak:
  url: ""  # Defaults to https://auth.${global.baseDomain}
  realm: stoa

# =============================================================================
# Kafka Configuration
# =============================================================================
kafka:
  bootstrapServers: redpanda.stoa-system.svc.cluster.local:9092

# =============================================================================
# MCP Gateway Configuration
# =============================================================================
mcpGateway:
  enabled: true
  image:
    repository: mcp-gateway
    tag: latest
    pullPolicy: Always
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  keycloak:
    clientId: stoa-mcp-gateway
    clientSecretRef:
      name: mcp-gateway-secrets
      key: keycloak-client-secret
  opa:
    enabled: true
    embedded: true
  metering:
    enabled: true
    topic: stoa.metering.events
  k8s:
    enabled: true
    watchAllNamespaces: true
    watchNamespace: ""
  service:
    type: ClusterIP
    port: 80
  ingress:
    enabled: true
    className: nginx
    clusterIssuer: letsencrypt-prod
    host: ""  # Defaults to mcp.${global.baseDomain}

# =============================================================================
# Gateway Configuration
# =============================================================================
gateway:
  healthcheck:
    enabled: false

# =============================================================================
# Backup Configuration
# =============================================================================
backup:
  enabled: false
  awx:
    enabled: false
  vault:
    enabled: false

# =============================================================================
# Monitoring (ServiceMonitors)
# =============================================================================
monitoring:
  enabled: true
  namespace: stoa-monitoring
  interval: 30s
  scrapeTimeout: 10s
  alerting:
    enabled: false

# =============================================================================
# Observability Ingress Configuration
# =============================================================================
observability:
  # Namespace where kube-prometheus-stack is installed
  namespace: stoa-monitoring

  ingress:
    enabled: true
    className: nginx
    clusterIssuer: letsencrypt-prod
    annotations: {}

  # Grafana configuration (service in monitoring namespace)
  grafana:
    host: ""  # Defaults to grafana.${global.baseDomain}
    serviceName: kube-prometheus-stack-grafana
    servicePort: 80

  # Prometheus configuration (service in monitoring namespace)
  prometheus:
    host: ""  # Defaults to prometheus.${global.baseDomain}
    serviceName: kube-prometheus-stack-prometheus
    servicePort: 9090
    basicAuth:
      enabled: false
      secretName: prometheus-basic-auth

  # Loki configuration (deployed in stoa-system namespace)
  loki:
    host: ""  # Defaults to loki.${global.baseDomain}
    basicAuth:
      enabled: false
      secretName: loki-basic-auth

# =============================================================================
# Loki Deployment Configuration
# =============================================================================
loki:
  enabled: true

  # Image configuration
  image:
    repository: grafana/loki
    tag: "2.9.4"
    pullPolicy: IfNotPresent

  # Replicas (StatefulSet)
  replicas: 1

  # Log level
  logLevel: info

  # Retention period (720h = 30 days)
  retention: 720h

  # Persistence
  persistence:
    size: 50Gi
    storageClass: ""  # Use default storage class if empty

  # Resource limits
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi

  # Node selector
  nodeSelector: {}

  # Tolerations
  tolerations: []

  # Affinity
  affinity: {}

# =============================================================================
# Promtail DaemonSet Configuration
# =============================================================================
promtail:
  enabled: true

  # Image configuration
  image:
    repository: grafana/promtail
    tag: "2.9.4"
    pullPolicy: IfNotPresent

  # Log level
  logLevel: info

  # Tenant ID for multi-tenant Loki
  tenantId: stoa

  # Namespace regex for pod log collection
  namespaceRegex: "stoa-system|stoa-.*"

  # Resource limits
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

  # Node selector
  nodeSelector: {}

  # Tolerations (already includes master/control-plane by default)
  tolerations: []
