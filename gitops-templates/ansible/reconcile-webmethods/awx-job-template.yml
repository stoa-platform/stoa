---
# awx-job-template.yml
# Configuration for creating AWX Job Template via API or import
#
# Import into AWX via:
#   awx-cli import --file awx-job-template.yml
# Or create manually via AWX UI

job_template:
  name: "STOA - Reconcile webMethods Gateway"
  description: "Reconcile webMethods Gateway APIs from GitOps repository"
  job_type: "run"
  inventory: "${AWX_INVENTORY_NAME}"
  project: "${AWX_PROJECT_NAME}"
  playbook: "ansible/reconcile-webmethods/reconcile-webmethods.yml"

  # Credentials
  credentials:
    - "${AWX_GATEWAY_CREDENTIAL}"
    - "${AWX_SCM_CREDENTIAL}"

  # Default variables
  extra_vars:
    env: "dev"
    delete_orphans: true

  # Options
  ask_variables_on_launch: true
  ask_credential_on_launch: false
  allow_simultaneous: false

  # Survey (launch form)
  survey_enabled: true
  survey_spec:
    name: "Reconciliation Parameters"
    description: "GitOps reconciliation configuration"
    spec:
      - question_name: "Environment"
        question_description: "Target environment"
        required: true
        type: "multiplechoice"
        variable: "env"
        default: "dev"
        choices:
          - "dev"
          - "staging"
          - "prod"

      - question_name: "Delete Orphans"
        question_description: "Delete APIs present on Gateway but missing from Git"
        required: true
        type: "multiplechoice"
        variable: "delete_orphans"
        default: "true"
        choices:
          - "true"
          - "false"

      - question_name: "Dry-Run Mode"
        question_description: "Simulate without applying changes"
        required: false
        type: "multiplechoice"
        variable: "dry_run"
        default: "false"
        choices:
          - "true"
          - "false"

# Webhook for external triggering (ArgoCD, GitLab)
webhook:
  enabled: true
  service: "github"  # Compatible with standard webhooks

---
# Credentials to create in AWX
# Replace placeholders with your actual values

credentials:
  - name: "${AWX_GATEWAY_CREDENTIAL}"
    credential_type: "Machine"
    inputs:
      username: "${WM_ADMIN_USER}"
      password: "${WM_ADMIN_PASSWORD}"

  - name: "${AWX_SCM_CREDENTIAL}"
    credential_type: "Source Control"
    inputs:
      username: "gitlab-ci-token"
      password: "${GITLAB_TOKEN}"
