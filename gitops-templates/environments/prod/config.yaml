# Production Environment Configuration
# Inherits from: _defaults.yaml
#
# Available variables (from _defaults.yaml):
#   - ${infrastructure.BASE_DOMAIN}: Base domain for the platform
#   - ${services.*}: Service URLs (gateway, portal, etc.)
#   - ${variables.*}: Default variable values
#
environment: prod
description: Production environment for live APIs

# Environment-specific overrides
variables:
  # Domain configuration (production uses base domain directly)
  ENV_DOMAIN: "${BASE_DOMAIN:stoa.cab-i.com}"
  GATEWAY_URL: "https://gateway.${BASE_DOMAIN:stoa.cab-i.com}"
  PORTAL_URL: "https://portal.${BASE_DOMAIN:stoa.cab-i.com}"
  KEYCLOAK_URL: "https://auth.${BASE_DOMAIN:stoa.cab-i.com}"
  CONTROL_PLANE_API_URL: "https://api.${BASE_DOMAIN:stoa.cab-i.com}"

  # Backend configuration (strict)
  BACKEND_TIMEOUT: "30"
  BACKEND_RETRY_COUNT: "3"
  BACKEND_RETRY_DELAY: "500"

  # Rate limiting (strict)
  RATE_LIMIT_REQUESTS: "100"
  RATE_LIMIT_WINDOW: "60"
  RATE_LIMIT_BURST: "20"

  # Logging (minimal)
  LOG_LEVEL: "WARNING"
  LOG_FORMAT: "json"

  # Security (strict)
  CORS_ALLOWED_ORIGINS: "https://*.${BASE_DOMAIN:stoa.cab-i.com}"
  CORS_MAX_AGE: "86400"

  # Monitoring (low sampling to reduce overhead)
  METRICS_ENABLED: "true"
  TRACING_ENABLED: "true"
  TRACING_SAMPLE_RATE: "0.1"

# Production-specific settings
settings:
  auto_deploy: false
  require_approval: true
  approval_roles:
    - cpi-admin
  require_staging_validation: true
  allow_untested_apis: false
  canary_deployment: true
  canary_percentage: 10
  auto_sync: false  # Manual sync only for production

# Vault path prefix for this environment
vault:
  enabled: ${VAULT_ENABLED:false}
  path_prefix: "secret/data/prod"

# Kubernetes configuration
kubernetes:
  cluster_url: "${K8S_CLUSTER_URL:https://kubernetes.default.svc}"
  namespace_suffix: "prod"

# Alerting configuration
alerting:
  enabled: true
  channels:
    - type: slack
      webhook: "vault:${VAULT_PATH_PREFIX:secret/data}/prod/alerts#slack_webhook"
    - type: pagerduty
      integration_key: "vault:${VAULT_PATH_PREFIX:secret/data}/prod/alerts#pagerduty_key"
